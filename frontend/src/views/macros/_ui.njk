{#
  Этот файл является библиотекой Nunjucks-макросов (аналог "миксинов" или "функций").
  Макросы - это переиспользуемые фрагменты кода для генерации HTML.

  ----------------------------------------------------------------------------------------------------
  КАК ИСПОЛЬЗОВАТЬ:
  ----------------------------------------------------------------------------------------------------

  1. Импортируйте этот файл в шаблоне, где хотите использовать макрос:
    {% import "../macros/_ui.njk" as ui %}

  2. Вызовите макрос по его имени через заданный псевдоним (`ui`):

    <!-- Простой вызов -->
    {{ ui.icon('phone') }}

    <!-- Вызов с дополнительным классом -->
    {{ ui.icon('arrow-right', 'button__icon') }}
  ----------------------------------------------------------------------------------------------------
#}

{#
  Макрос для вставки SVG-иконки из автоматически генерируемого спрайта.

  @param {string} name - Имя (ID) иконки без префикса "icon-".
  @param {string} [class] - (Опционально) Дополнительный CSS-класс для тега <svg>.
#}
{% macro icon(name, class) %}
  <svg class="icon icon-{{ name }}{% if class %} {{ class }}{% endif %}" aria-hidden="true" focusable="false">
    {#
    Путь /img/sprite.svg будет корректно работать после сборки,
    т.к. Vite поместит спрайт в dist/img/sprite.svg.
  #}
    <use xlink:href="/img/sprite.svg#icon-{{ name }}"></use>
  </svg>
{% endmacro %}

{#
  Макрос для создания "ловушки для ботов" (Honeypot).
  Создает поле, невидимое для людей, но видимое для ботов.
#}
{% macro honeypot(name='bot-field') %}
  <div style="position: absolute; left: -5000px;" aria-hidden="true">
    <input type="text" name="{{ name }}" tabindex="-1" value="">
  </div>
{% endmacro %}

{#
  УМНЫЙ МАКРОС INPUT
  Генерирует поле ввода. Приоритет отдается переданным параметрам.
  Если type='tel' и placeholder не указан, используется значение по умолчанию.
#}
{% macro input(name, label, type='text', className, wrapperClass='form-field', labelClass='form-field__label', placeholder, required=false, pattern, autocomplete) -%}
  {#
    Логика с приоритетом:
    1. Сначала берем `placeholder`, который передал пользователь.
    2. Если он НЕ был передан (is none), И тип поля 'tel', ТОЛЬКО ТОГДА используем наш дефолт.
  #}
  {% set final_placeholder = placeholder if placeholder is not none else 
    ("|+375..." if type == 'tel') %}
  {% set final_pattern = pattern if pattern is not none else ("\\s*\\+375\\s?\\(?(1[567]|2[12359]|33|44)\\)?\\s?\\d{3}-\\d{2}-\\d{2}" if type == 'tel') %}
  {% set final_autocomplete = autocomplete if autocomplete is not none else 
    ("tel" if type == 'tel') %}

  {# Генерируем HTML для самого <input> #}
  {% set input_html %}
  <input type="{{ type }}" id="{{ name }}" name="{{ name }}" class="{{ className }}" {% if final_placeholder %} placeholder="{{ final_placeholder }}" {% endif %} {% if required %} required{% endif %}="required{% endif %}" {% if final_pattern %} pattern="{{ final_pattern }}" {% if final_autocomplete %} autocomplete="{{ final_autocomplete }}">
  {% endset %}

  {# Если передан `label`, оборачиваем инпут #}
  {% if label %}
    <div class="{{ wrapperClass }}">
      <label for="{{ name }}" class="{{ labelClass }}">{{ label }}</label>
      {{- input_html | safe -}}
    </div>
  {% else %}
    {# Иначе выводим "голый" инпут #}
    {{- input_html | safe -}}
  {% endif %}
{%- endmacro %}

{#
  ----------------------------------------------------------------------------------------------------
  КАК ТЕПЕРЬ ИСПОЛЬЗОВАТЬ:
  ----------------------------------------------------------------------------------------------------

  1. Импортируем файл:
    {% import "../macros/_ui.njk" as ui %}

  2. Телефон БЕЗ лейбла (как в нашей форме):
    {{ ui.input(name='phone', type='tel', className='form__phone-field') }}

  3. Телефон С лейблом (для другого места на сайте):
    {{ ui.input(
        name='contact-phone',
        type='tel',
        label='Ваш номер телефона',
        className='another-form__input'
    ) }}

  4. Телефон С ДЕФОЛТНЫМ ПЛЕЙСХОЛДЕРОМ (как в нашей форме):
    {{ ui.input(name='phone', type='tel', className='form__phone-field') }}
    (Результат: placeholder="|+375...")

  5. Телефон С КАСТОМНЫМ ПЛЕЙСХОЛДЕРОМ (если понадобится в другом месте):
  {{ ui.input(
        name='phone',
        type='tel',
        className='form__phone-field',
        placeholder='Ваш мобильный'
    ) }}

  6. Обычное текстовое поле (работает как и раньше):
  {{ ui.input(name='user-name', label='Ваше имя', className='form__input') }}
----------------------------------------------------------------------------------------------------
#}